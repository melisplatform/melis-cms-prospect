$(document).ready(function(){$("body").on("change",".dashchartline",function(){simpleChartInit($(this).val())}),"undefined"!=typeof charts&&(charts.chart_simple={data:{d1:[]},plot:null,options:{grid:{color:"#dedede",borderWidth:1,borderColor:"#eee",clickable:!0,hoverable:!0,labelMargin:20},series:{lines:{show:!0,fill:!1,lineWidth:2,steps:!1},points:{show:!0,radius:5,lineWidth:3,fill:!0,fillColor:"#000"}},xaxis:{mode:"time",tickColor:"#eee"},yaxis:{show:!0,tickColor:"#eee",min:0,tickDecimals:0},legend:{position:"nw",noColumns:2,backgroundColor:null,backgroundOpacity:0},shadowSize:0,tooltip:!0,tooltipOpts:{content:"%y %s - %x",shifts:{x:-30,y:-50},defaultTheme:!1}},placeholder:"#chart_simple",init:function(){null==this.plot&&simpleChartInit()}},window.simpleChartInit=function(e){void 0===e&&(e="daily"),$.ajax({type:"POST",url:"/melis/MelisCmsProspects/Dashboard/getDashboardStats",data:{chartFor:e},dataType:"json",encode:!0}).success(function(t){for(var s=t.values,o=s.length,i=[],r=null,a=0;a<o;a++){var l=new Date(s[a][0]),n=(new Date,l.getMonth()),c=l.getFullYear(),m=new Date(c,n,1.5),d=new Date(c,0,2);"daily"==e?r=l.getTime():"monthly"==e?r=m.getTime():"yearly"==e&&(r=d.getTime()),i.push([r,s[a][1]])}charts.chart_simple.plot=$.plot($(charts.chart_simple.placeholder),[{label:"Prospects",data:i,color:successColor,lines:{fill:.2},points:{fillColor:"#fff"}}],charts.chart_simple.options)}).error(function(e,t,s){alert("ERROR !! Status = "+t+"\n Error = "+s+"\n xhr = "+e.statusText)})},charts.chart_simple.init(),$('a[href="#chart-simple-lines"]').on("shown.bs.tab",function(){null==charts.chart_simple.plot&&charts.chart_simple.init()}),$("body").on("click",'.btn-group a[href="#chart-simple-lines"]',function(){$(this).parent().find("[data-toggle]").removeClass("active"),$(this).addClass("active")}))}),$(document).ready(function(){$("body").on("change",".dashchartbar",function(){simpleBarsInit($(this).val())}),"undefined"!=typeof charts&&(charts.chart_simple_bars={data:{d1:[]},plot:null,options:{grid:{color:"#dedede",borderWidth:1,borderColor:"#eee",clickable:!0,hoverable:!0,labelMargin:20},series:{bars:{show:!0,barWidth:62208e3,fill:!0,align:"center"},shadowSize:0},xaxis:{mode:"time",timeformat:"%b %d",position:"bottom",tickColor:"#eee"},yaxis:{show:!0,tickColor:"#eee",tickDecimals:0,min:0},legend:{position:"nw",noColumns:2,backgroundColor:null,backgroundOpacity:0},shadowSize:0,tooltip:!0,tooltipOpts:{content:"%y %s - %x",shifts:{x:-30,y:-50},defaultTheme:!1}},placeholder:"#chart_simple_bars",init:function(){null==this.plot&&simpleBarsInit()}},window.simpleBarsInit=function(e){void 0===e&&(e="daily"),$.ajax({type:"POST",url:"/melis/MelisCmsProspects/Dashboard/getDashboardStats",data:{chartFor:e},dataType:"json",encode:!0}).success(function(t){var s=charts.chart_simple_bars.options;switch(e){case"daily":s.xaxis.timeformat="%b %d",s.series.bars.barWidth=62208e3;break;case"monthly":s.xaxis.timeformat="%b",s.series.bars.barWidth=15552e5;break;case"yearly":s.xaxis.timeformat="%Y",s.series.bars.barWidth=1741824e4}charts.chart_simple_bars.plot=$.plot($(charts.chart_simple_bars.placeholder),[{label:"Prospects",data:t.values,color:successColor}],charts.chart_simple_bars.options)}).error(function(e,t,s){alert("ERROR !! Status = "+t+"\n Error = "+s+"\n xhr = "+e.statusText)})},$("body").on("shown.bs.tab",'a[href="#chart-simple-bars"]',function(){var e=$("#chart_simple_bars").data("plot");null!=charts.chart_simple_bars.plot&&void 0!==e||simpleBarsInit()}),$("body").on("click",'.btn-group a[href="#chart-simple-bars"]',function(){$(this).parent().find("[data-toggle]").removeClass("active"),$(this).addClass("active")}))}),$(document).ready(function(){var e=$("body");e.on("click",".btnEditProspect",function(){var e=$(this).parents("tr").attr("id");melisCoreTool.hideAlert("#prospectupdateformalert"),toolProspects.getProspectDataById(e)}),e.on("click",".btnProspectDelete",function(){var e=$(this).parents("tr").attr("id");toolProspects.deleteProspectData(e)}),e.on("apply.daterangepicker","#dt_bsdatepicker",function(e,t){fntableToolProspectinit()}),e.on("click",".btnMelisProspectExport",function(){var e=$("input[type='search'][aria-controls='tableToolProspect']").val();melisCoreTool.isTableEmpty("tableToolProspect")||melisCoreTool.exportData("/melis/MelisCmsProspects/ToolProspects/exportToCsv?filter="+e)}),e.on("click","#id_MelisCmsProspects_tool_prospects_modal .tooltabmodal .mce-btn",function(){$("#mce-modal-block").length&&($("#mce-modal-block").css("z-index",1059),$(".mce-floatpanel.mce-window").css("z-index",1060))})}),window.initProspectEditor=function(){melisTinyMCE.createTinyMCE("tool","textarea#id_pros_message",{height:200})},window.initDatePickerFilter=function(e){e.startDate=dStartDate,e.endDate=dEndDate;var t='<i class="glyphicon glyphicon-calendar fa fa-calendar"></i> ',s="";s=0==dStartDate.length&&0==dEndDate.length?translations.tr_meliscore_datepicker_select_date+t+' <b class="caret"></b>':translations.tr_meliscore_datepicker_select_date+t+"<span class='sdate'>"+dStartDate+" - "+dEndDate+'</span> <b class="caret"></b>',$(document).on("init.dt",function(e,t){$("#tableToolProspect_wrapper #dt_bsdatepicker .dt_dateInfo").html(s),dStartDate="",dEndDate=""}),initSiteList(e)},window.initSiteList=function(e){$("#prosSiteSelect").length&&(e.pros_site_id=$("#prosSiteSelect").val())};var toolProspects={table:function(){return"#tableToolProspect"},initTool:function(){melisCoreTool.initTable(toolProspects.table())},refreshTable:function(){melisHelper.zoneReload("id_MelisCmsProspects_tool_prospects","MelisCmsProspects_tool_prospects")},updateProspectData:function(){var e=$("#idformprospectdata").serializeArray();e=$.param(e),melisCoreTool.pending("#btnProspectUpdate"),$.ajax({type:"POST",url:"/melis/MelisCmsProspects/ToolProspects/updateProspectData",data:e,dataType:"json",encode:!0}).done(function(e){e.success?(toolProspects.refreshTable(),$(".modal").modal("hide"),melisCoreTool.resetLabels("#idformprospectdata"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):(melisCoreTool.alertDanger("#prospectupdateformalert","",e.textMessage),melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors,0),melisCoreTool.highlightErrors(e.success,e.errors,"idformprospectdata")),melisCore.flashMessenger(),melisCoreTool.done("#btnProspectUpdate")})},deleteProspectData:function(e){melisCoreTool.confirm(translations.tr_meliscore_common_yes,translations.tr_meliscore_common_no,translations.tr_prospect_manager_fm_delete_data_title,translations.tr_tool_text_prospect_manager_delete_confirm,function(){$.ajax({type:"GET",url:"/melis/MelisCmsProspects/ToolProspects/removeProspectData?id="+e,dataType:"json",encode:!0,success:function(e){melisCoreTool.pending(".btn-danger"),e.success?(toolProspects.refreshTable(),melisHelper.melisOkNotification(e.textTitle,e.textMessage,"#72af46")):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors,0),melisCore.flashMessenger(),melisCoreTool.done(".btn-danger")}})})},getProspectDataById:function(e){zoneId="id_MelisCmsProspects_tool_prospects_update_modal_content",melisKey="MelisCmsProspects_tool_prospects_update_modal_content",modalUrl="melis/MelisCmsProspects/ToolProspects/renderToolProspectsModalContainer",melisHelper.createModal(zoneId,melisKey,!1,{prospectId:e},modalUrl,function(){})}};window.setThemeId=function(e){var t=parseInt(activeTabId.split("_")[0]);e.themeId=t},$(function(){var e=$("body"),t="id_MelisCmsProspects_tool_themes_modal_content",s="MelisCmsProspects_tool_themes_modal_content",o="/melis/MelisCmsProspects/ProspectThemes/toolModalContainer";e.on("click","button#btn_prospect_theme_add",function(){melisCoreTool.pending("button#btn_prospect_theme_add"),melisHelper.createModal(t,s,!0,{},o,function(){melisCoreTool.done("button#btn_prospect_theme_add")})}),e.on("click","button.btn_prospects_theme_edit",function(){var e=$(this).parents("tr").attr("id");melisCoreTool.pending("button#btn_prospects_theme_edit"),melisHelper.createModal(t,s,!1,{id:e},o,function(){melisCoreTool.pending("button#btn_prospects_theme_edit")})}),e.on("submit","form#prospects_theme_form",function(e){var t="form#"+$(this).attr("id"),s=$(this).serializeArray(),o=$(t+" input#pros_theme_id").val();s.push({name:"pros_theme_id",value:o}),$(t+" input, button").not("input#pros_theme_id").attr("disabled","disabled"),$.ajax({type:"POST",url:"/melis/MelisCmsProspects/ProspectThemes/save",data:$.param(s),dataType:"json",encode:!0}).done(function(e){e.success?($(".modal").modal("hide"),$("a.melis-refreshTable").trigger("click"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors,0),melisCoreTool.highlightErrors(e.success,e.errors,"prospects_theme_form")),melisCore.flashMessenger(),$(t+" input, button").not("input#pros_theme_id").removeAttr("disabled")}),e.preventDefault()}),e.on("click","button.btn_prospects_theme_items",function(){var e=$(this).parents("tr").attr("id"),t=$(this).parents("tr").find("td:nth-child(2)").html();melisHelper.tabOpen(translations.tr_melis_cms_prospects_theme+" / "+t,"fa-edit",e+"_id_MelisCmsProspects_tool_theme_items","MelisCmsProspects_tool_theme_items",{id:e})}),e.on("click","button.btn_prospects_theme_delete",function(){var e=$(this).parents("tr").attr("id");$("button").attr("disabled","disabled"),melisCoreTool.confirm(translations.tr_meliscore_common_yes,translations.tr_meliscore_common_no,translations.tr_melis_cms_prospects_theme,translations.tr_melis_cms_prospects_theme_delete_confirm,function(){$.ajax({type:"POST",url:"/melis/MelisCmsProspects/ProspectThemes/remove",data:{id:e},dataType:"json",encode:!0}).done(function(e){e.success?($("a.melis-refreshTable").trigger("click"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors,0),melisCore.flashMessenger()})}),$("button").removeAttr("disabled")})}),$(function(){var e=$("body"),t="id_MelisCmsProspects_tool_theme_items_modal_content",s="MelisCmsProspects_tool_theme_items_modal_content",o="/melis/MelisCmsProspects/ProspectThemeItems/toolModalContainer";e.on("click","button#btn_prospect_theme_items_add",function(){melisHelper.createModal(t,s,!0,{},o,function(){})}),e.on("click","div.tool-prospect-theme-items-refresh > a.melis-refreshTableThemeItem",function(){var e=parseInt(activeTabId.split("_")[0]),t=$(this).parents(".container-level-a").data("meliskey");$(this).parents(".container-level-a").attr("id");melisHelper.zoneReload(activeTabId,t,{id:e})}),e.on("click","button#btn-save-theme-items",function(){var e=$("#id_MelisCmsProspects_tool_theme_items_modal_content form"),t=[],s=0,o=0;t.push({name:"themeId",value:parseInt(activeTabId.split("_")[0])}),e.each(function(){var e=$(this).serializeArray();for(len=e.length,j=0;j<len;j++)t.push({name:"forms["+s+"]["+e[j].name+"]",value:e[j].value});s++,o++}),$.ajax({type:"POST",url:"/melis/MelisCmsProspects/ProspectThemeItems/saveItem",data:t,dataType:"json",encode:!0}).done(function(e){e.success?($(".modal").modal("hide"),$("a.melis-refreshTableThemeItem").trigger("click"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):(melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors,0),melisCoreTool.highlightErrors(e.success,e.errors,"prospects_theme_item_form")),melisCore.flashMessenger()})}),e.on("submit","form#prospects_theme_item_code_form",function(e){var i="form#"+$(this).attr("id"),r=$(this).serializeArray(),a=$(i+" input#pros_theme_item_id").val(),l=parseInt(activeTabId.split("_")[0]);r.push({name:"pros_theme_item_id",value:a}),r.push({name:"pros_theme_id",value:l}),$(i+" input button").not("input#pros_theme_item_id").attr("disabled","disabled"),$.ajax({type:"POST",url:"/melis/MelisCmsProspects/ProspectThemeItems/saveCode",data:$.param(r),dataType:"json",encode:!0}).done(function(e){if(e.success){$(".modal").modal("hide"),$("a.melis-refreshTableThemeItem").trigger("click"),melisHelper.melisOkNotification(e.textTitle,e.textMessage);var r=parseInt(activeTabId.split("_")[0]),a=$("input#pros_theme_item_code").val();melisHelper.createModal(t,s,!0,{themeId:r,code:a},o)}else melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors,0),melisCoreTool.highlightErrors(e.success,e.errors,"prospects_theme_item_code_form");melisCore.flashMessenger(),$(i+" input button").not("input#pros_theme_item_id").attr("disabled","disabled")}),e.preventDefault()}),e.on("click","button.btn_prospects_theme_items_edit",function(e){var i=(parseInt(activeTabId.split("_")[0]),$(this).parents("tr").attr("id"));$(this).attr("disabled","disabled"),melisHelper.createModal(t,s,!0,{itemId:i},o,function(){$("button.btn_prospects_theme_items_edit").removeAttr("disabled")})}),e.on("click","button.btn_prospects_theme_items_delete",function(){var e=$(this).parents("tr").attr("id");$("button").attr("disabled","disabled"),melisCoreTool.confirm(translations.tr_meliscore_common_yes,translations.tr_meliscore_common_no,translations.tr_melis_cms_prospects_theme_items,translations.tr_melis_cms_prospects_theme_item_delete_confirm,function(){$.ajax({type:"POST",url:"/melis/MelisCmsProspects/ProspectThemeItems/remove",data:{itemId:e},dataType:"json",encode:!0}).done(function(e){e.success?($("a.melis-refreshTableThemeItem").trigger("click"),melisHelper.melisOkNotification(e.textTitle,e.textMessage)):melisHelper.melisKoNotification(e.textTitle,e.textMessage,e.errors,0),melisCore.flashMessenger()})}),$("button").removeAttr("disabled")})});